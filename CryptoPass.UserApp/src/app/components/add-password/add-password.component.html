<div class="bitwarden-form">
  <div class="form-header">
    <h2>{{ password() ? 'Edit Item' : 'Add ' + getItemTypeLabel() }}</h2>
    <button type="button" class="btn-close" (click)="onCancel()">
      <i class="pi pi-times"></i>
    </button>
  </div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <div class="form-section">
      <div class="form-group">
        <label for="title">Name</label>
        <input
          id="title"
          type="text"
          class="bw-input"
          formControlName="title"
          placeholder="Name"
        />
        @if (getErrorMessage('title')) {
          <span class="error-text">{{ getErrorMessage('title') }}</span>
        }
      </div>
    </div>

    @if (selectedItemType() === 'login') {
      <div class="form-section">
        <div class="section-title">Login Details</div>
        
        <div class="form-group">
          <label for="username">Username</label>
          <input
            id="username"
            type="text"
            class="bw-input"
            formControlName="username"
            placeholder="Username"
          />
          @if (getErrorMessage('username')) {
            <span class="error-text">{{ getErrorMessage('username') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div class="bw-input-group">
            <input
              id="password"
              [type]="showPassword() ? 'text' : 'password'"
              class="bw-input"
              formControlName="password"
              placeholder="Password"
            />
            <button type="button" class="bw-btn-icon" (click)="togglePasswordVisibility()" title="Toggle visibility">
              <i [class]="showPassword() ? 'pi pi-eye-slash' : 'pi pi-eye'"></i>
            </button>
            <button type="button" class="bw-btn-icon" (click)="generatePassword()" title="Generate password">
              <i class="pi pi-refresh"></i>
            </button>
          </div>
          @if (getErrorMessage('password')) {
            <span class="error-text">{{ getErrorMessage('password') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="url">URI</label>
          <input
            id="url"
            type="url"
            class="bw-input"
            formControlName="url"
            placeholder="https://example.com"
          />
        </div>

        <div class="form-group">
          <label for="totpSecret">Authenticator Key (TOTP) <span class="optional-label">(Optional)</span></label>
          <div class="bw-input-group">
            <input
              id="totpSecret"
              type="text"
              class="bw-input"
              formControlName="totpSecret"
              placeholder="JBSWY3DPEHPK3PXP (Optional)"
            />
            <button type="button" class="bw-btn-icon" (click)="generateTotpSecret()" title="Generate secret">
              <i class="pi pi-refresh"></i>
            </button>
          </div>
          @if (form.value.totpSecret && form.value.totpSecret.trim()) {
            <div class="totp-preview">
              <div class="totp-code">{{ getCurrentTotpCode() }}</div>
              <div class="totp-timer">
                <div class="totp-timer-bar" [style.width.%]="getTotpProgress()"></div>
              </div>
              <div class="totp-label">Preview: Updates every 30 seconds</div>
            </div>
          }
        </div>
      </div>
    }

    @if (selectedItemType() === 'note') {
      <div class="form-section">
        <div class="section-title">Note Content</div>
        
        <div class="form-group">
          <label for="noteContent">Content</label>
          <textarea
            id="noteContent"
            class="bw-input bw-textarea"
            formControlName="noteContent"
            placeholder="Your secure note..."
            rows="10"
          ></textarea>
          @if (getErrorMessage('noteContent')) {
            <span class="error-text">{{ getErrorMessage('noteContent') }}</span>
          }
        </div>
      </div>
    }

    @if (selectedItemType() === 'address') {
      <div class="form-section">
        <div class="section-title">Address Details</div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="firstName">First Name</label>
            <input
              id="firstName"
              type="text"
              class="bw-input"
              formControlName="firstName"
              placeholder="First Name"
            />
          </div>
          
          <div class="form-group">
            <label for="lastName">Last Name</label>
            <input
              id="lastName"
              type="text"
              class="bw-input"
              formControlName="lastName"
              placeholder="Last Name"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="addressLine1">Address Line 1</label>
          <input
            id="addressLine1"
            type="text"
            class="bw-input"
            formControlName="addressLine1"
            placeholder="Street Address"
          />
          @if (getErrorMessage('addressLine1')) {
            <span class="error-text">{{ getErrorMessage('addressLine1') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="addressLine2">Address Line 2</label>
          <input
            id="addressLine2"
            type="text"
            class="bw-input"
            formControlName="addressLine2"
            placeholder="Apartment, suite, etc."
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="city">City</label>
            <input
              id="city"
              type="text"
              class="bw-input"
              formControlName="city"
              placeholder="City"
            />
            @if (getErrorMessage('city')) {
              <span class="error-text">{{ getErrorMessage('city') }}</span>
            }
          </div>
          
          <div class="form-group">
            <label for="state">State / Province</label>
            <input
              id="state"
              type="text"
              class="bw-input"
              formControlName="state"
              placeholder="State"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="postalCode">Postal Code</label>
            <input
              id="postalCode"
              type="text"
              class="bw-input"
              formControlName="postalCode"
              placeholder="Postal Code"
            />
          </div>
          
          <div class="form-group">
            <label for="country">Country</label>
            <input
              id="country"
              type="text"
              class="bw-input"
              formControlName="country"
              placeholder="Country"
            />
            @if (getErrorMessage('country')) {
              <span class="error-text">{{ getErrorMessage('country') }}</span>
            }
          </div>
        </div>
      </div>
    }

    @if (selectedItemType() === 'card') {
      <div class="form-section">
        <div class="section-title">Card Details</div>
        
        <div class="form-group">
          <label for="cardholderName">Cardholder Name</label>
          <input
            id="cardholderName"
            type="text"
            class="bw-input"
            formControlName="cardholderName"
            placeholder="Name on Card"
          />
          @if (getErrorMessage('cardholderName')) {
            <span class="error-text">{{ getErrorMessage('cardholderName') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="cardNumber">Card Number</label>
          <input
            id="cardNumber"
            type="text"
            class="bw-input"
            formControlName="cardNumber"
            placeholder="1234 5678 9012 3456"
          />
          @if (getErrorMessage('cardNumber')) {
            <span class="error-text">{{ getErrorMessage('cardNumber') }}</span>
          }
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="expirationMonth">Expiration Month</label>
            <input
              id="expirationMonth"
              type="text"
              class="bw-input"
              formControlName="expirationMonth"
              placeholder="MM"
            />
          </div>
          
          <div class="form-group">
            <label for="expirationYear">Expiration Year</label>
            <input
              id="expirationYear"
              type="text"
              class="bw-input"
              formControlName="expirationYear"
              placeholder="YYYY"
            />
          </div>

          <div class="form-group">
            <label for="cvv">CVV</label>
            <input
              id="cvv"
              type="text"
              class="bw-input"
              formControlName="cvv"
              placeholder="123"
            />
          </div>
        </div>
      </div>
    }

    <div class="form-section">
      <div class="section-title">Additional Notes</div>
      
      <div class="form-group">
        <textarea
          id="notes"
          class="bw-input bw-textarea"
          formControlName="notes"
          placeholder="Add any additional notes..."
          rows="3"
        ></textarea>
      </div>
    </div>

    <div class="form-footer">
      <button type="button" class="bw-btn bw-btn-secondary" (click)="onCancel()">
        Cancel
      </button>
      <button type="submit" class="bw-btn bw-btn-primary" [disabled]="!form.valid">
        Save
      </button>
    </div>
  </form>
</div>
