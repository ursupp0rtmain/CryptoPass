import{f as h}from"./chunk-ZVNJROIG.js";import{O as d,T as m}from"./chunk-XQ36P3UB.js";import{k as s}from"./chunk-KYPE3LET.js";var l=class o{ceramicService=m(h);streamIdCache=new Map;getLatestVault(t){return s(this,null,function*(){if(!this.ceramicService.isSessionValid())return null;try{let r=yield this.ceramicService.getVaultEntries();for(let e of r)e.streamId&&this.streamIdCache.set(e.id,e.streamId);let a=r.filter(e=>e.encryptedData&&e.serviceName!=="[DELETED]"&&e.encryptedData!=="DELETED_ENTRY");return{version:"2.0.0",walletAddress:t,passwords:a,createdAt:Date.now(),updatedAt:Date.now()}}catch(r){throw r}})}uploadVault(t){return s(this,null,function*(){if(!this.ceramicService.isSessionValid())throw new Error("Ceramic session not valid - please authenticate first");let r=yield this.ceramicService.getVaultEntries(),a=new Set(r.map(e=>e.id));for(let e of r)e.streamId&&this.streamIdCache.set(e.id,e.streamId);for(let e of t.passwords){let i=this.toVaultEntryInput(e);if(a.has(e.id)){let c=this.streamIdCache.get(e.id);c&&(yield this.ceramicService.updateVaultEntry(c,i))}else{let c=yield this.ceramicService.addVaultEntry(i);this.streamIdCache.set(e.id,c)}}let n=new Set(t.passwords.map(e=>e.id));for(let e of r)if(!n.has(e.id)){let i=this.streamIdCache.get(e.id);i&&(yield this.ceramicService.deleteVaultEntry(i),this.streamIdCache.delete(e.id))}return"synced"})}addEntry(t){return s(this,null,function*(){if(!this.ceramicService.isSessionValid())throw new Error("Ceramic session not valid");let r=this.toVaultEntryInput(t),a=yield this.ceramicService.addVaultEntry(r);return this.streamIdCache.set(t.id,a),a})}updateEntry(t){return s(this,null,function*(){if(!this.ceramicService.isSessionValid())throw new Error("Ceramic session not valid");let r=this.streamIdCache.get(t.id);if(!r){yield this.addEntry(t);return}let a=this.toVaultEntryInput(t);yield this.ceramicService.updateVaultEntry(r,a)})}deleteEntry(t){return s(this,null,function*(){if(!this.ceramicService.isSessionValid())throw new Error("Ceramic session not valid");let r=this.streamIdCache.get(t);r&&(yield this.ceramicService.deleteVaultEntry(r),this.streamIdCache.delete(t))})}toVaultEntryInput(t){let r=t;return{entryId:t.id,itemType:t.type||"login",serviceName:r.serviceName||"Unknown",encryptedData:t.encryptedData,iv:t.iv,category:r.category,favorite:r.favorite,createdAt:new Date(t.createdAt).toISOString(),updatedAt:new Date(t.updatedAt).toISOString()}}clearCache(){this.streamIdCache.clear()}hashWalletAddress(t){return s(this,null,function*(){let a=new TextEncoder().encode(t.toLowerCase()),n=yield crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(n)).map(i=>i.toString(16).padStart(2,"0")).join("")})}static \u0275fac=function(r){return new(r||o)};static \u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})};export{l as a};
