import{a as O}from"./chunk-RF25V7NY.js";import{c as h,d as S,f as b}from"./chunk-ZVNJROIG.js";import{Da as w,La as g,Ma as p,T as d,Ta as t,Ua as i,Va as s,Wa as v,Xa as M,Y as x,Z as f,Za as u,_a as l,cb as r,db as E,ea as m,fb as y,qa as c,yb as P}from"./chunk-XQ36P3UB.js";import"./chunk-IDCDGEFH.js";import"./chunk-BXSD24PQ.js";import"./chunk-TF4TY5JN.js";import{k as _}from"./chunk-KYPE3LET.js";function k(o,n){if(o&1&&(t(0,"div",11),s(1,"i",14),t(2,"p"),r(3),i()()),o&2){let e=l(2);c(3),E(e.errorMessage())}}function T(o,n){if(o&1&&(s(0,"i",15),t(1,"span"),r(2),i()),o&2){let e=l(2);c(2),E(e.connectionStep()||"Connecting...")}}function D(o,n){o&1&&(s(0,"i",16),t(1,"span"),r(2,"Connect Wallet"),i())}function I(o,n){if(o&1){let e=v();t(0,"div",6),s(1,"i",10),g(2,k,4,1,"div",11),t(3,"button",12),u("click",function(){x(e);let C=l();return f(C.connectWallet())}),g(4,T,3,1)(5,D,3,0),i(),t(6,"div",13)(7,"p"),r(8,"Connect your wallet to sync with the browser extension."),i(),t(9,"p",9),r(10,"Your passwords are encrypted locally and stored on IPFS."),i()()()}if(o&2){let e=l();c(2),p(e.errorMessage()?2:-1),c(),M("disabled",e.isConnecting()),c(),p(e.isConnecting()?4:5)}}function z(o,n){if(o&1){let e=v();t(0,"div",7)(1,"div",17),s(2,"i",18),i(),t(3,"h2"),r(4,"Successfully Connected!"),i(),t(5,"p",19),r(6),i(),t(7,"p",20),r(8,"You can now close this page and use the extension."),i(),t(9,"button",21),u("click",function(){x(e);let C=l();return f(C.closeTab())}),s(10,"i",22),t(11,"span"),r(12,"Close Page"),i()()()}if(o&2){let e,a=l();c(6),y(" Wallet: ",(e=a.walletState().address)==null?null:e.slice(0,6),"...",(e=a.walletState().address)==null?null:e.slice(-4)," ")}}var L=class o{web3Service=d(h);encryptionService=d(S);ceramicService=d(b);storageService=d(O);isConnecting=m(!1);isLoggedIn=m(!1);errorMessage=m(null);connectionStep=m("");walletState=this.web3Service.walletState;connectWallet(){return _(this,null,function*(){this.isConnecting.set(!0),this.errorMessage.set(null);try{if(!this.web3Service.isMetaMaskInstalled())throw new Error("No wallet detected. Please install MetaMask, Uniswap Wallet, or another Web3 wallet.");this.connectionStep.set("Connecting to wallet..."),yield this.web3Service.connect(),this.connectionStep.set("Creating decentralized identity...");let n=yield this.ceramicService.authenticate(window.ethereum);this.connectionStep.set("Deriving encryption key...");let e=yield this.encryptionService.deriveMasterKey(n);this.connectionStep.set("Syncing with extension..."),this.notifyExtension(e),yield this.syncVaultToExtension(),this.isLoggedIn.set(!0),this.connectionStep.set("")}catch(n){this.errorMessage.set(n.message||"Failed to connect wallet. Please try again.")}finally{this.isConnecting.set(!1),this.isLoggedIn()||this.connectionStep.set("")}})}notifyExtension(n){let e=this.walletState().address,a=this.ceramicService.getCurrentDID();window.postMessage({type:"CRYPTOPASS_LOGIN",walletAddress:e,masterKey:n,ceramicDid:a},"*")}syncVaultToExtension(){return _(this,null,function*(){try{let n=this.walletState().address;if(!n)return;let e=yield this.storageService.getLatestVault(n);if(!e||!e.passwords||e.passwords.length===0){window.postMessage({type:"CRYPTOPASS_VAULT_UPDATE",vault:[]},"*");return}let a=yield this.encryptionService.decryptBatchFromCeramic(e.passwords);window.postMessage({type:"CRYPTOPASS_VAULT_UPDATE",vault:a},"*")}catch(n){console.error("Failed to sync vault to extension:",n)}})}closeTab(){window.close()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=w({type:o,selectors:[["app-extension-login"]],decls:13,vars:1,consts:[[1,"login-container"],[1,"login-card","card","glass"],[1,"login-header"],[1,"display-font"],[1,"subtitle"],[1,"login-content"],[1,"connect-section"],[1,"success-section"],[1,"login-footer"],[1,"small"],[1,"pi","pi-wallet","wallet-icon"],[1,"error-message"],[1,"btn","btn-primary",3,"click","disabled"],[1,"info-text"],[1,"pi","pi-times-circle"],[1,"pi","pi-spin","pi-spinner"],[1,"pi","pi-sign-in"],[1,"success-icon"],[1,"pi","pi-check-circle"],[1,"wallet-info"],[1,"hint"],[1,"btn","btn-secondary",3,"click"],[1,"pi","pi-times"]],template:function(e,a){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),r(4,"CryptoPass"),i(),t(5,"p",4),r(6,"Browser Extension Login"),i()(),t(7,"div",5),g(8,I,11,3,"div",6)(9,z,13,2,"div",7),i(),t(10,"div",8)(11,"p",9),r(12,"Zero-Knowledge \u2022 Decentralized \u2022 Secure"),i()()()()),e&2&&(c(8),p(a.isLoggedIn()?9:8))},dependencies:[P],styles:[".login-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:var(--sp-4)}.login-card[_ngcontent-%COMP%]{max-width:500px;width:100%;text-align:center}.login-header[_ngcontent-%COMP%]{margin-bottom:var(--sp-5)}.login-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:3rem;margin:0 0 var(--sp-2) 0;background:linear-gradient(135deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.login-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--text-color);margin:0}.login-content[_ngcontent-%COMP%]{margin-bottom:var(--sp-5)}.connect-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--sp-4);align-items:center}.wallet-icon[_ngcontent-%COMP%]{font-size:4rem;color:var(--text-color);opacity:.7}.warning-message[_ngcontent-%COMP%], .error-message[_ngcontent-%COMP%]{padding:var(--sp-3);border-radius:var(--r-sm);display:flex;flex-direction:column;gap:var(--sp-2);align-items:center}.warning-message[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .error-message[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem}.warning-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.warning-message[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%], .error-message[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{font-size:.9rem;opacity:.8}.warning-message[_ngcontent-%COMP%]{background:#ffc1071a;border:1px solid rgba(255,193,7,.3);color:#ffc107}.error-message[_ngcontent-%COMP%]{background:#f443361a;border:1px solid rgba(244,67,54,.3);color:#f44336}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);border:none;color:#fff;padding:var(--sp-3) var(--sp-6);font-size:1.1rem;font-weight:600;display:flex;align-items:center;gap:var(--sp-2);justify-content:center;min-width:200px}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:var(--shadow-pop)}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:wait}.info-text[_ngcontent-%COMP%]{text-align:center}.info-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:var(--sp-2) 0;color:var(--text-color)}.info-text[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{font-size:.85rem;opacity:.7}.login-footer[_ngcontent-%COMP%]{padding-top:var(--sp-4);border-top:1px solid var(--border-color)}.login-footer[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-color);opacity:.6;margin:0}.success-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:var(--sp-3)}.success-section[_ngcontent-%COMP%]   .success-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:#4caf50}.success-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;color:#4caf50;margin:0}.success-section[_ngcontent-%COMP%]   .wallet-info[_ngcontent-%COMP%]{font-family:monospace;color:var(--text-color);opacity:.8;margin:0}.success-section[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{color:var(--text-color);opacity:.6;font-size:.9rem;margin:0}.btn-secondary[_ngcontent-%COMP%]{background:transparent;border:1px solid var(--border-color);color:var(--text-color);padding:var(--sp-2) var(--sp-4);display:flex;align-items:center;gap:var(--sp-2);justify-content:center}.btn-secondary[_ngcontent-%COMP%]:hover{background:#ffffff1a}"]})};export{L as ExtensionLoginComponent};
